<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>X Live - Aventurine & [Your Name]</title>
<style>
/* æ ¹å®¹å™¨éš”ç¦»ä¸åŸºç¡€æ ·å¼ */
.theater-root {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background-color: #000000;
    color: #e7e9ea;
    height: 850px; /* ç‰©ç†æ’‘é«˜ */
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    border: 1px solid #2f3336;
    border-radius: 16px;
    overflow: hidden;
    position: relative;
    display: flex;
    flex-direction: column;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

/* å¯åŠ¨å¼¹çª— */
.start-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.95);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    color: #fff;
}

.modal-content {
    background: #16181c;
    padding: 30px;
    border-radius: 20px;
    border: 1px solid #d9b665;
    max-width: 400px;
    width: 80%;
    text-align: center;
}

.modal-content h2 {
    color: #d9b665;
    margin-bottom: 20px;
    font-size: 24px;
}

.modal-content p {
    color: #aab8c2;
    margin-bottom: 25px;
    font-size: 14px;
    line-height: 1.5;
}

.name-input {
    width: 100%;
    padding: 15px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid #2f3336;
    border-radius: 10px;
    color: #fff;
    font-size: 16px;
    margin-bottom: 20px;
    text-align: center;
    outline: none;
    transition: border 0.3s;
}

.name-input:focus {
    border-color: #d9b665;
}

.start-btn {
    background: linear-gradient(135deg, #d9b665 0%, #c9a555 100%);
    color: #000;
    border: none;
    padding: 15px 30px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: transform 0.2s, opacity 0.2s;
    width: 100%;
}

.start-btn:hover {
    transform: scale(1.03);
    opacity: 0.9;
}

.start-btn:active {
    transform: scale(0.98);
}

/* éšè—å¼¹çª— */
.start-modal.hidden {
    display: none;
}

/* é¡¶éƒ¨å¯¼èˆªæ¨¡æ‹Ÿ */
.header {
    padding: 12px 16px;
    border-bottom: 1px solid #2f3336;
    display: flex;
    align-items: center;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(10px);
    z-index: 10;
}
.back-icon { margin-right: 20px; font-size: 20px; cursor: pointer; }
.host-info { flex: 1; }
.host-name { font-weight: 700; font-size: 16px; display: flex; align-items: center; gap: 4px; }
.verified-icon { color: #d9b665; width: 18px; height: 18px; fill: currentColor; } /* ç ‚é‡‘çš„é‡‘æ ‡ */
.live-tag { background: #f91880; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; margin-left: 8px; text-transform: uppercase; }
.viewer-count { color: #71767b; font-size: 13px; }

/* è§†é¢‘ä¸»èˆå° */
.video-stage {
    flex: 1;
    position: relative;
    background: #16181c;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    overflow: hidden;
    cursor: default;
}

/* æ¨¡æ‹Ÿè§†é¢‘ç”»é¢èƒŒæ™¯ï¼ˆä½¿ç”¨å¤–éƒ¨å›¾ç‰‡ï¼‰ */
.video-bg {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: 
        linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), /* å˜æš—å åŠ å±‚ */
        url('https://drive.google.com/thumbnail?id=1EKS0m6lLPcJgbZr5xgvQtgMWYhw8k_80&sz=w1000') center/cover no-repeat;
    z-index: 0;
}
.video-bg::after {
    content: "";
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g fill="%23ffffff" fill-opacity="0.03"><circle cx="20" cy="20" r="1"/><circle cx="60" cy="80" r="1"/><circle cx="90" cy="10" r="1"/></g></svg>');
    animation: grain 2s steps(4) infinite;
}

/* å­—å¹•ä¸æ—ç™½åŒºåŸŸ */
.subtitle-layer {
    position: absolute;
    bottom: 220px; /* ç•™å‡ºå¼¹å¹•åŒºé«˜åº¦ */
    left: 0;
    width: 100%;
    padding: 20px;
    box-sizing: border-box;
    z-index: 5;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    transition: all 0.3s ease;
}

.narration {
    font-style: italic;
    color: #aab8c2;
    font-size: 13px;
    margin-bottom: 8px;
    background: rgba(0,0,0,0.4);
    padding: 4px 8px;
    border-radius: 4px;
    display: inline-block;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.5s ease;
}
.narration.active { opacity: 1; transform: translateY(0); }

.dialogue-box {
    background: rgba(0, 0, 0, 0.6);
    border-left: 4px solid #d9b665; /* ç ‚é‡‘ä»£è¡¨è‰² */
    padding: 10px 15px;
    border-radius: 0 8px 8px 0;
    min-height: 60px;
    display: flex;
    flex-direction: column;
}

.speaker-name {
    font-size: 12px;
    font-weight: 800;
    margin-bottom: 4px;
    text-transform: uppercase;
    color: #d9b665;
}
.speaker-name.user { color: #f91880; border-color: #f91880; }

.caption-text {
    font-size: 15px;
    line-height: 1.5;
    color: #fff;
    white-space: pre-wrap;
}

/* äº¤äº’é€‰é¡¹å±‚ */
.interaction-overlay {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 20;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
}
.interaction-overlay.active { opacity: 1; pointer-events: auto; }

.choice-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid #d9b665;
    color: #fff;
    padding: 15px 20px;
    margin: 10px;
    width: 80%;
    text-align: center;
    border-radius: 25px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s;
    backdrop-filter: blur(5px);
}
.choice-btn:hover { background: rgba(217, 182, 101, 0.2); transform: scale(1.02); }
.choice-btn:active { transform: scale(0.98); }

/* åº•éƒ¨å¼¹å¹•åŒº */
.danmaku-container {
    height: 200px;
    background: #000000;
    border-top: 1px solid #2f3336;
    overflow-y: auto;
    padding: 10px 0;
    position: relative;
    z-index: 10;
}
.danmaku-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 0 15px;
}
.danmaku-item {
    background: transparent;
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: flex-start;
    border: 1px solid #2f3336;
}
.danmaku-item:hover { background: rgba(29, 155, 240, 0.1); border-color: #1d9bf0; }
.danmaku-item.disabled { opacity: 0.5; cursor: not-allowed; text-decoration: line-through; }
.avatar {
    width: 24px; height: 24px;
    border-radius: 50%;
    background: #333;
    margin-right: 10px;
    flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 10px; color: #888;
}
.comment-content { color: #e7e9ea; line-height: 1.4; }
.username { font-weight: bold; color: #71767b; margin-right: 5px; font-size: 12px; }

/* åº•éƒ¨æ§åˆ¶æ æ¨¡æ‹Ÿ */
.controls {
    height: 50px;
    border-top: 1px solid #2f3336;
    display: flex;
    align-items: center;
    padding: 0 15px;
    justify-content: space-between;
    background: #000;
}
.input-fake { color: #71767b; font-size: 14px; }
.actions { display: flex; gap: 15px; color: #1d9bf0; font-size: 20px; }

/* çŠ¶æ€æŒ‡ç¤ºå™¨ */
.status-indicator {
    position: absolute;
    top: 20px; right: 20px;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 5px;
    z-index: 5;
}
.now-playing {
    background: rgba(0,0,0,0.6);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    color: #d9b665;
    border: 1px solid #d9b665;
    display: none;
}

@keyframes grain {
    0%, 100% { transform: translate(0, 0); }
    10% { transform: translate(-5%, -10%); }
    20% { transform: translate(-15%, 5%); }
    30% { transform: translate(7%, -25%); }
    40% { transform: translate(-5%, 25%); }
    50% { transform: translate(-15%, 10%); }
    60% { transform: translate(15%, 0%); }
    70% { transform: translate(0%, 15%); }
    80% { transform: translate(3%, 35%); }
    90% { transform: translate(-10%, 10%); }
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 480px) {
    .subtitle-layer { bottom: 180px; }
    .danmaku-container { height: 160px; }
    .modal-content { padding: 20px; }
}
</style>
</head>
<body>

<!-- å¯åŠ¨å¼¹çª— -->
<div class="start-modal" id="startModal">
    <div class="modal-content">
        <h2>æ¬¢è¿æ¥åˆ°X Live</h2>
        <p>è¯·è¾“å…¥ä½ çš„åå­—</p>
        <input type="text" class="name-input" id="userNameInput" placeholder="è¾“å…¥ä½ çš„åå­—" maxlength="20" autofocus>
        <button class="start-btn" id="startBtn">å¼€å§‹ç›´æ’­ä½“éªŒ</button>
    </div>
</div>

<div class="theater-root" id="mainContent" style="display: none;">
    <!-- å¤´éƒ¨ -->
    <div class="header">
        <div class="back-icon">âœ•</div>
        <div class="host-info">
          <div class="host-name">
          Aventurine_Official 
          <svg class="verified-icon" viewBox="0 0 24 24"><path d="M22.5 12.5c0-1.58-.875-2.95-2.148-3.6.154-.435.238-.905.238-1.4 0-2.21-1.71-3.998-3.818-3.998-.47 0-.92.084-1.336.25C14.818 2.415 13.51 1.5 12 1.5s-2.816.917-3.437 2.25c-.415-.165-.866-.25-1.336-.25-2.11 0-3.818 1.79-3.818 4 0 .495.083.965.238 1.4-1.272.65-2.147 2.02-2.147 3.6 0 1.457.748 2.795 1.867 3.47-.5 1.535-.293 3.32.738 4.78l.04.055c.015.02.03.037.046.052.793 1.055 2.033 1.637 3.353 1.637.28 0 .565-.027.848-.08.625 1.042 1.724 1.695 2.95 1.695s2.324-.653 2.95-1.695c.282.053.567.08.85.08 1.32 0 2.56-.58 3.35-1.636l.046-.053.04-.055c1.03-1.46 1.238-3.245.738-4.78 1.12-.675 1.867-2.013 1.867-3.47zm-8.293 2.155l-4.5 4.5c-.172.17-.41.27-.665.27s-.494-.1-.665-.27l-2-2c-.367-.367-.367-.96 0-1.327s.96-.367 1.327 0l1.338 1.338 3.834-3.834c.367-.367.96-.367 1.327 0s.367.96 0 1.327z"/></svg>
          <span class="live-tag">LIVE</span>
          </div>
          <div class="viewer-count">ğŸ‘ 2.1M watching â€¢ ğŸ’— 8.5M likes</div>
        </div>
    </div>

    <!-- è§†é¢‘èˆå° -->
    <div class="video-stage" id="videoStage">
        <div class="video-bg"></div>
        
        <div class="status-indicator">
          <div class="now-playing" id="nowPlayingTopic">TOPIC: Q&A</div>
        </div>

        <!-- äº¤äº’å±‚ -->
        <div class="interaction-overlay" id="choiceOverlay">
          <div style="color: #fff; margin-bottom: 20px; font-weight: bold; font-size: 18px;">åšå‡ºä½ çš„ååº”</div>
          <div class="choice-btn" id="choiceA">é€‰é¡¹ A</div>
          <div class="choice-btn" id="choiceB">é€‰é¡¹ B</div>
        </div>

        <!-- å­—å¹•å±‚ -->
        <div class="subtitle-layer">
          <div class="narration" id="narrationText">è§†é¢‘ç”»é¢ï¼šç ‚é‡‘æ­£æ‡’æ´‹æ´‹åœ°é åœ¨ç”µç«æ¤…ä¸Šï¼Œä¸€åªæ‰‹æ­åœ¨ä½ çš„è‚©å¤´ã€‚</div>
          <div class="dialogue-box">
          <div class="speaker-name" id="speakerName">Aventurine</div>
          <div class="caption-text" id="captionText">æ¬¢è¿å›åˆ°æˆ‘ä»¬çš„é¢‘é“ï¼Œæœ‹å‹ä»¬ã€‚ä»Šå¤©æ˜¯ä¸€æœŸç‰¹åˆ«èŠ‚ç›®â€”â€”è¯»è¯»ä½ ä»¬é‚£äº›...å……æ»¡æƒ³è±¡åŠ›çš„è¯„è®ºã€‚</div>
          </div>
        </div>
    </div>

    <!-- å¼¹å¹•åˆ—è¡¨ -->
    <div class="danmaku-container">
        <div class="danmaku-list" id="danmakuList">
          <!-- JS ç”Ÿæˆ -->
        </div>
    </div>

    <!-- åº•éƒ¨æ  -->
    <div class="controls">
        <div class="input-fake">Say something...</div>
        <div class="actions">
          <span>ğŸ¤</span><span>â†»</span><span>â†‘</span>
        </div>
    </div>
</div>

<script>
// å…¨å±€å˜é‡ - ç”¨æˆ·è‡ªå®šä¹‰åå­—
let USER_NAME = "Ruoyun"; // é»˜è®¤å€¼
let USER_NAME_DISPLAY = "ç®¬äº‘"; // é»˜è®¤æ˜¾ç¤ºå

// è§’è‰²è®¾å®š
const CHAR_NAME = "Aventurine";

// è¯„è®ºåº“ (15æ¡) - åŸå§‹æ•°æ®
const comments = [
    {
        id: 1,
        user: "ChipLover_77",
        avatar: "C",
        text: "å¬è¯´ç®¬äº‘ç§ä¸‹å…¶å®æ˜¯ä¸ªé‡åº¦äºŒæ¬¡å…ƒæ­»å®…ï¼ŸçœŸçš„å‡çš„ï¼Ÿ",
        script: {
          av_start: {
          narration: "ç ‚é‡‘æŒ‘äº†æŒ‘çœ‰ï¼Œä¾§å¤´çœ‹å‘ä½ ï¼Œæ‰‹æŒ‡è½»è½»å·èµ·ä½ çš„ä¸€ç¼•é»‘å‘ã€‚",
          text: "å“¦ï¼Ÿè¿™ä¹Ÿç®—ç§˜å¯†å—ï¼Ÿä½ ä»¬åº”è¯¥çœ‹çœ‹å¥¹çœ‹åˆ°é™é‡æ‰‹åŠæ—¶çš„çœ¼ç¥...ç®€ç›´æ¯”çœ‹åˆ°æˆ‘è¿˜æ²¡ç©¿è¡£æœæ—¶è¿˜è¦äº®ã€‚"
          },
          choices: [
          { text: "å†·ç€è„¸åæ§½ï¼šâ€œåˆ«æ‹¿ä½ è‡ªå·±è·Ÿæ‰‹åŠæ¯”ï¼Œä½ è¾“å®šäº†ã€‚â€", response_key: "A" },
          { text: "æ‰“æ‰ä»–çš„æ‰‹ï¼šâ€œé—­å˜´ï¼Œé‚£æ˜¯è‰ºæœ¯ã€‚â€", response_key: "B" }
          ],
          av_response: {
          A: {
          narration: "ç ‚é‡‘å‘å‡ºä¸€å£°å¤¸å¼ çš„å¹æ¯ï¼Œèº«ä½“å´æ›´è´´è¿‘äº†ä½ ï¼Œæ‰‹è‡‚å æœ‰æ¬²åè¶³åœ°ç¯ä½ä½ çš„è…°ã€‚",
          text: "å¥½ä¼¤å¿ƒå•Šï¼Œç”œå¿ƒã€‚çœ‹æ¥æˆ‘è¿™ä¸ªæŠ•èµ„è€…è¿˜å¾—å†åŠªåŠ›ä¸€ç‚¹ï¼Œäº‰å–å“ªå¤©èƒ½åœ¨é‚£å †å¡‘æ–™å°äººé‡Œ...æ··ä¸ªæ¯”å®ƒä»¬ç¨é«˜ä¸€ç‚¹çš„åœ°ä½ï¼Ÿä¸è¿‡ï¼Œè¿™å¯æ˜¯ä½ è¯´çš„ï¼Œä»Šæ™šæˆ‘å°±è®©ä½ é‡æ–°è¯„ä¼°ä¸€ä¸‹...åˆ°åº•è°æ¯”è¾ƒ'å¥½ç©'ã€‚"
          },
          B: {
          narration: "ä»–é¡ºåŠ¿æ¡ä½ä½ æ‰“è¿‡æ¥çš„æ‰‹ï¼Œæ”¾åœ¨å”‡è¾¹è½»å»äº†ä¸€ä¸‹æ‰‹èƒŒï¼Œçœ¼ç¥é‡Œå…¨æ˜¯å® æººçš„ç¬‘æ„ã€‚",
          text: "æ˜¯æ˜¯æ˜¯ï¼Œè‰ºæœ¯ã€‚é‚£æˆ‘ä¸ºä½ æ¸…ç©ºè´­ç‰©è½¦çš„é‚£ä¸€åˆ»ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿç®—ä¸€ç§...è¡Œä¸ºè‰ºæœ¯ï¼Ÿæ¯•ç«Ÿï¼Œèƒ½åšå¾—ç®¬äº‘å°å§ä¸€ç¬‘ï¼Œè¿™ç‚¹ä¿¡ç”¨ç‚¹èŠ±å¾—å¯å¤ªå€¼äº†ã€‚æœ‹å‹ä»¬ï¼Œçœ‹åˆ°äº†å—ï¼Ÿè¿™å°±æ˜¯æˆ‘çš„å®¶åº­åœ°ä½ã€‚"
          }
          }
        }
    },
    {
        id: 2,
        user: "Golden_Dog",
        avatar: "G",
        text: "å¥½å¥‡ä½ ä»¬è°ç®¡é’±ï¼Ÿç ‚é‡‘æ€»ç›‘çœ‹èµ·æ¥å¾ˆå¤§æ‰‹å¤§è„šå“ã€‚",
        script: {
          av_start: {
          narration: "ç ‚é‡‘å‘å‡ºä¸€å£°è½»ç¬‘ï¼Œä»å£è¢‹é‡Œæå‡ºä¸€æšç­¹ç ï¼Œåœ¨æŒ‡å°–çµæ´»åœ°ç¿»è½¬ã€‚",
          text: "é’±ï¼Ÿè¿™ç§åº¸ä¿—çš„ä¸œè¥¿è¿˜éœ€è¦'ç®¡'å—ï¼Ÿåªè¦ç”œå¿ƒæƒ³è¦ï¼Œæ•´ä¸ªæ˜Ÿé™…å’Œå¹³å…¬å¸çš„é‡‘åº“å¤§é—¨æˆ‘éƒ½èƒ½è¯•ç€å»...æ•²ä¸€æ•²ã€‚"
          },
          choices: [
          { text: "é¢æ— è¡¨æƒ…ï¼šâ€œæˆ‘ä¸ç®¡é’±ï¼Œæˆ‘åªè´Ÿè´£èŠ±ã€‚â€", response_key: "A" },
          { text: "å¹æ°”ï¼šâ€œä¸»è¦æ˜¯è´Ÿè´£æ‹¦ç€ä»–ä¸ä¹±ä¹°å¥‡æ€ªçš„æƒ…è¶£ç”¨å“ã€‚â€", response_key: "B" }
          ],
          av_response: {
          A: {
          narration: "ä»–æ»¡æ„åœ°ç‚¹ç‚¹å¤´ï¼Œå°†é‚£æšç­¹ç è½»è½»å¡è¿›ä½ çš„é¢†å£ï¼Œå†°å‡‰çš„è§¦æ„Ÿè®©ä½ ç¼©äº†ç¼©è„–å­ã€‚",
          text: "è¿™å°±å¯¹äº†ã€‚ä½ çš„ä»»åŠ¡å°±æ˜¯ä¿æŒè¿™ä»½ç¾ä¸½å’Œå¿«ä¹ï¼Œè‡³äºèµšå–ç­¹ç è¿™ç§è„æ´»ç´¯æ´»...äº¤ç»™æˆ‘è¿™ä¸ªèµŒå¾’å°±å¥½ã€‚æ€ä¹ˆï¼Œè¿™æšç­¹ç ä¸å–œæ¬¢ï¼Ÿè¿™å¯æ˜¯èƒ½æ¢ä¸€é¢—å°è¡Œæ˜Ÿçš„ç‰¹åˆ«ç‰ˆå“¦ã€‚"
          },
          B: {
          narration: "ç ‚é‡‘ä¸ä»…æ²¡æœ‰ç¾æ„§ï¼Œåè€Œç¬‘å¾—æ›´ç¿çƒ‚äº†ï¼Œå‡‘åˆ°éº¦å…‹é£å‰å‹ä½å£°éŸ³ã€‚",
          text: "å“å‘€ï¼Œè¿™å°±è¢«ä½ æ›å…‰äº†ï¼Ÿä¸è¿‡æœ‹å‹ä»¬è¯„è¯„ç†ï¼Œé‚£äº›ä¸œè¥¿...æœ€åäº«å—åˆ°çš„äººä¸ä¹Ÿæ˜¯ä½ å—ï¼Ÿä¸Šæ¬¡é‚£ä»¶'çŒ«è€³'é£æ ¼çš„...æˆ‘çœ‹ä½ ä¹Ÿå¹¶æ²¡æœ‰å¾ˆæŠ—æ‹’å˜›ï¼Œç”šè‡³è¿˜..."
          }
          }
        }
    },
    {
        id: 3,
        user: "Stardust_XXX",
        avatar: "S",
        text: "æƒ³çœ‹ç®¬äº‘æˆ´é¡¹åœˆï¼ï¼ï¼é‚£ç§å¸¦é“¾å­çš„ï¼æ±‚æ±‚äº†ï¼",
        script: {
          av_start: {
          narration: "ç ‚é‡‘çœ¼ç¥ç¬é—´æš—äº†æš—ï¼ŒåŸæœ¬æ‡’æ•£çš„åå§¿ç¨å¾®ç«¯æ­£äº†ä¸€äº›ï¼Œä½†å˜´è§’ä¾æ—§æŒ‚ç€ç¬‘ã€‚",
          text: "å•§ï¼Œè¿™ä½æœ‹å‹çš„å£å‘³...è™½ç„¶æˆ‘å¾ˆæ¬£èµï¼Œä½†ä¸å¾—ä¸æé†’ä½ ä¸€å¥â€”â€”æœ‰äº›ç”»é¢ï¼Œåªæœ‰ä»˜è´¹ç”¨æˆ·...å“¦ä¸ï¼Œåªæœ‰æˆ‘ä¹Ÿèƒ½çœ‹ã€‚"
          },
          choices: [
          { text: "ç¿»ç™½çœ¼ï¼šâ€œæƒ³å¾—ç¾ï¼Œåšæ¢¦å»å§ã€‚â€", response_key: "A" },
          { text: "çœ‹å‘ç ‚é‡‘ï¼šâ€œä½ ä¸Šæ¬¡æ˜¯ä¸æ˜¯ä¹°äº†ä¸€ä¸ªè—åœ¨æŸœå­é‡Œï¼Ÿâ€", response_key: "B" }
          ],
          av_response: {
          A: {
          narration: "ä»–ä¼¸æ‰‹æäº†æä½ çš„åé¢ˆï¼ŒæŒ‡è…¹åœ¨ä½ çš„åŠ¨è„‰å¤„å±é™©åœ°æ‘©æŒ²ï¼Œè¯­æ°”å˜å¾—æœ‰äº›ä½æ²‰å–‘å“‘ã€‚",
          text: "å¬åˆ°äº†å—ï¼Ÿæˆ‘å®¶å°ç¥–å®—è¯´ä¸è¡Œã€‚ä¸è¿‡...ç§ä¸‹é‡Œå˜›ï¼Œå¦‚æœä½ è¡¨ç°å¾—ä¹–ä¸€ç‚¹ï¼Œæˆ–è®¸æˆ‘å¯ä»¥è€ƒè™‘è®©ä½ è‡ªå·±æŒ‘ä¸€ä¸ªå–œæ¬¢çš„é¢œè‰²ï¼Ÿé‡‘è‰²æ€ä¹ˆæ ·ï¼Ÿå¾ˆè¡¬ä½ çš„çš®è‚¤ã€‚"
          },
          B: {
          narration: "ç ‚é‡‘æ„£äº†ä¸€ä¸‹ï¼Œéšå³çˆ†å‘å‡ºä¸€é˜µå¤§ç¬‘ï¼Œæ•´ä¸ªäººå‡ ä¹ç¬‘å€’åœ¨ä½ èº«ä¸Šã€‚",
          text: "å“ˆå“ˆå“ˆå“ˆï¼ä¸æ„§æ˜¯ä½ ï¼Œä»€ä¹ˆéƒ½ç’ä¸è¿‡ä½ çš„çœ¼ç›ã€‚æ—¢ç„¶è¢«å‘ç°äº†...é‚£ä»Šæ™šç›´æ’­ç»“æŸåï¼Œæˆ‘ä»¬å°±æ¥ä¸ª'å¼€ç®±æµ‹è¯„'ï¼Ÿæ”¾å¿ƒï¼Œæˆ‘ä¼šå…³æ‰æ‘„åƒå¤´çš„...å¤§æ¦‚ï¼Ÿ"
          }
          }
        }
    },
    {
        id: 4,
        user: "Void_Ranger",
        avatar: "V",
        text: "ç®¬äº‘çœ‹èµ·æ¥æ€»æ˜¯å¥½ç´¯çš„æ ·å­ï¼Œæ˜¯ä¸æ˜¯ç ‚é‡‘å¤ªé‚£å•¥äº†...æ‡‚çš„éƒ½æ‡‚ã€‚",
        script: {
          av_start: {
          narration: "ç ‚é‡‘å‡‘è¿‘é•œå¤´ï¼Œéœ²å‡ºä¸€ä¸ªæå…¶æ— è¾œçš„è¡¨æƒ…ï¼Œä½†é‚£åŒå¼‚è‰²çš„çœ¼ç›é‡Œå…¨æ˜¯ç‹¡é» ã€‚",
          text: "å†¤æ‰å•Šã€‚æˆ‘å¯æ˜¯å…¨å®‡å®™æœ€ä½“è´´çš„ç»…å£«ã€‚ä¸è¿‡å˜›...æ¯•ç«Ÿæˆ‘æ˜¯ä¸ªèµŒå¾’ï¼Œä¸€æ—¦ä¸Šäº†èµŒæ¡Œï¼ˆåºŠï¼‰ï¼Œä¸èµ¢åˆ°æœ€åæ€ä¹ˆè‚¯æ”¶æ‰‹ï¼Ÿ"
          },
          choices: [
          { text: "æ‰“å“ˆæ¬ ï¼šâ€œä¸»è¦æ˜¯å¿ƒç´¯ã€‚å¸¦å­©å­å¤ªç´¯äº†ã€‚â€", response_key: "A" },
          { text: "çªä»–ä¸€çœ¼ï¼šâ€œç²¾åŠ›ä¸è¶³ï¼Œå‹¿æ‰°ã€‚ä»Šæ™šåˆ†æˆ¿ç¡ã€‚â€", response_key: "B" }
          ],
          av_response: {
          A: {
          narration: "ä»–å§”å±ˆåœ°è¹­äº†è¹­ä½ çš„è„¸é¢Šï¼Œåƒåªæ±‚å…³æ³¨çš„å¤§å‹çŒ«ç§‘åŠ¨ç‰©ã€‚",
          text: "å¸¦å­©å­ï¼Ÿæˆ‘æ€ä¹ˆè®°å¾—æ˜¨æ™šæœ‰äººå“­ç€å–Š'daddy'çš„æ—¶å€™...å¯ä¸æ˜¯è¿™ç§æ€åº¦ï¼Ÿå¥½äº†å¥½äº†ï¼Œä»Šæ™šè®©ä½ æ—©ç‚¹ç¡...åœ¨æˆ‘çš„æ€€é‡Œç¡ã€‚è¿™æ€»è¡Œäº†å§ï¼Ÿ"
          },
          B: {
          narration: "ä»–çš„ç¬‘å®¹åƒµåœ¨è„¸ä¸Šï¼Œéšå³ç«‹åˆ»æ¢ä¸Šä¸€å‰¯è®¨å¥½çš„è¡¨æƒ…ï¼ŒæŠ“èµ·ä½ çš„æ‰‹è´´åœ¨è‡ªå·±è„¸ä¾§ã€‚",
          text: "åˆ«å•Šï¼åˆ†æˆ¿ç¡ï¼Ÿé‚£è°æ¥ç»™ä½ å½“æŠ±æ•ï¼Ÿè°æ¥ç»™ä½ æš–åºŠï¼Ÿæœ‹å‹ä»¬ï¼Œå¿«å¸®æˆ‘æ±‚æ±‚æƒ…ã€‚åˆ†æˆ¿æ˜¯ä¸å¯èƒ½åˆ†æˆ¿çš„ï¼Œè¿™è¾ˆå­éƒ½ä¸å¯èƒ½ã€‚å¤§ä¸äº†...æˆ‘ä»Šæ™šåªåŠ¨å£ä¸åŠ¨æ‰‹ï¼Ÿæˆ‘è§‰å¾—æˆ‘ä»¬å¯ä»¥è¯•è¯•åªç”¨å£"
          }
          }
        }
    },
    {
        id: 5,
        user: "IPC_Invest_Bot",
        avatar: "I",
        text: "ä¸‹æœŸè§†é¢‘èƒ½ä¸èƒ½å‡ºCosplayï¼Ÿæƒ³çœ‹å…”å¥³éƒæˆ–è€…ä¿®å¥³ï¼",
        script: {
          av_start: {
          narration: "ç ‚é‡‘æ‘¸ç€ä¸‹å·´ï¼Œä¼¼ä¹åœ¨è®¤çœŸæ€è€ƒè¿™ä¸ªæè®®çš„å¯è¡Œæ€§ã€‚",
          text: "ä¿®å¥³...ç¦æ¬²ç³»ï¼Ÿå—¯...åœ¨ç¥åœ£çš„ä¼ªè£…ä¸‹åšä¸€äº›äºµæ¸çš„äº‹æƒ…ï¼Œç¡®å®å¾ˆç¬¦åˆæˆ‘çš„ç¾å­¦ã€‚äº²çˆ±çš„ï¼Œä½ æ€ä¹ˆçœ‹ï¼Ÿ"
          },
          choices: [
          { text: "æ‹’ç»ä¸‰è¿ï¼šâ€œä¸ç©¿ï¼Œä¸æƒ³ï¼Œä¸æ‹ã€‚â€", response_key: "A" },
          { text: "æŒ‡ç€ç ‚é‡‘ï¼šâ€œé™¤éä½ ç©¿ï¼Œæˆ‘å°±è€ƒè™‘ã€‚â€", response_key: "B" }
          ],
          av_response: {
          A: {
          narration: "ä»–è€¸äº†è€¸è‚©ï¼Œå¯¹ç€é•œå¤´åšäº†ä¸€ä¸ª'æˆ‘ä¹Ÿæ²¡åŠæ³•'çš„æ‰‹åŠ¿ã€‚",
          text: "çœ‹å§ï¼Œæˆ‘ä¹Ÿå¾ˆéš¾åŠã€‚ä¸è¿‡...å¦‚æœæ˜¯ä¸ºäº†'è‰ºæœ¯çŒ®èº«'ï¼Œæˆ‘ç›¸ä¿¡æˆ‘æœ‰åŠæ³•è¯´æœå¥¹ã€‚æ¯”å¦‚...é‚£ä¸€æŸœå­çš„ç»ç‰ˆæ¼«ç”»ï¼Ÿæˆ–è€…...æŸä¸ªæ˜Ÿçƒçš„æ°¸ä¹…å±…ä½æƒï¼Ÿæˆ‘ä»¬èµ°ç€ç§ã€‚"
          },
          B: {
          narration: "ç ‚é‡‘æŒ‘èµ·çœ‰æ¯›ï¼Œçœ¼ç¥å˜å¾—æœ‰äº›å±é™©ï¼Œèº«ä½“å‰å€¾å‹è¿«æ„Ÿåè¶³ã€‚",
          text: "å“¦ï¼Ÿæƒ³çœ‹æˆ‘ç©¿ï¼Ÿè¿™å¯æ˜¯å¦å¤–çš„ä»·é’±äº†...ä¸è¿‡ï¼Œå¦‚æœè¿™æ˜¯ä½ çš„æ„¿æœ›ï¼Œæˆ‘å¯ä»¥å’Œä½ æ‰“ä¸ªèµŒã€‚å¦‚æœä»Šæ™šä½ èƒ½åšæŒåˆ°æœ€åä¸æ±‚é¥¶...ä¸‹æœŸè§†é¢‘ï¼Œæˆ‘å°±ç©¿ç»™ä½ çœ‹ã€‚æ•¢èµŒå—ï¼Ÿ"
          }
          }
        }
    },
    { id: 6, user: "Kaka_Fan", avatar: "K", text: "ç ‚é‡‘è„–å­ä¸Šçš„çº¹èº«æ˜¯çœŸçš„å—ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„ç©æ³•ï¼Ÿ", script: null },
    { id: 7, user: "MeowMeow", avatar: "M", text: "ç®¬äº‘èƒ½ä¸èƒ½å¯¹é•œå¤´è¯´ä¸€å¥â€œæˆ‘çˆ±ä½ â€ï¼Ÿæƒ³çœ‹ç ‚é‡‘ç ´é˜²ã€‚", script: null },
    { id: 8, user: "Gambler_Win", avatar: "G", text: "è°æ˜¯ä¸Šé¢é‚£ä¸ªï¼Ÿè™½ç„¶å¾ˆæ˜æ˜¾ä½†è¿˜æ˜¯æƒ³é—®ï¼", script: null },
    { id: 9, user: "SleepyHead", avatar: "H", text: "å¹³æ—¶é™¤äº†é‚£ä¸ªï¼Œä½ ä»¬è¿˜ä¼šæœ‰ä»€ä¹ˆå¨±ä¹æ´»åŠ¨å—ï¼Ÿ", script: null },
    { id: 10, user: "Rich_B", avatar: "R", text: "èƒ½çœ‹çœ‹ä½ ä»¬çš„ç©å…·æŸœå—ï¼Ÿ", script: null },
    { id: 11, user: "Truth_Doc", avatar: "T", text: "å»ºè®®è¿™ä¸¤äººç«‹åˆ»å»é¢†è¯ï¼Œåˆ«åœ¨è¿™æ±¡æŸ“ç½‘ç»œç¯å¢ƒã€‚", script: null },
    { id: 12, user: "Mask_Fool", avatar: "F", text: "å“ˆå“ˆå“ˆï¼å¥½æƒ³çœ‹ç ‚é‡‘åƒç˜ªçš„æ ·å­ï¼", script: null },
    { id: 13, user: "Topaz_Numby", avatar: "T", text: "è®°å¾—æŠ¥ç¨ã€‚è¿™æœŸè§†é¢‘æ”¶ç›Šä¸é”™ã€‚", script: null },
    { id: 14, user: "Anon_Star", avatar: "A", text: "ä½ ä»¬ä¸¤ä¸ªçœŸçš„æ˜¯æƒ…ä¾£å—ï¼Ÿè¿˜æ˜¯å•çº¯çš„åˆçº¦å…³ç³»ï¼Ÿ", script: null },
    { id: 15, user: "Love_U_3000", avatar: "L", text: "ä»Šæ™šè¿˜ä¼šç›´æ’­åç»­å†…å®¹å—ï¼Ÿæˆ‘æ˜¯å°Šè´µçš„VIPï¼", script: null }
];

// é€šç”¨å‰§æœ¬ï¼ˆç”¨äºæœªè¯¦ç»†ç¼–å†™çš„IDï¼‰
const genericScript = {
    av_start: {
        narration: "ç ‚é‡‘æ‰«äº†ä¸€çœ¼å¼¹å¹•ï¼Œå˜´è§’å‹¾èµ·ä¸€æŠ¹æ„å‘³æ·±é•¿çš„å¼§åº¦ã€‚",
        text: "è¿™ä¸ªé—®é¢˜å˜›...æœ‰ç‚¹è¶Šç•Œäº†å“¦æœ‹å‹ã€‚ä¸è¿‡çœ‹åœ¨ä½ è¿™ä¹ˆå¥½å¥‡çš„ä»½ä¸Š..."
    },
    choices: [
        { text: "æ‰“æ–­ä»–ï¼šâ€œä¸‹ä¸€ä¸ªã€‚â€", response_key: "A" },
        { text: "é…åˆï¼šâ€œæ— å¯å¥‰å‘Šã€‚â€", response_key: "B" }
    ],
    av_response: {
        A: {
          narration: "ä»–ç¬‘ç€æ‘Šå¼€æ‰‹ï¼Œä¸€å‰¯å® æººçš„æ ·å­ã€‚",
          text: "å¬åˆ°äº†å—ï¼Ÿè€æ¿å‘è¯äº†ã€‚çœ‹æ¥è¿™ä¸ªç§˜å¯†åªèƒ½ç•™ç€æˆ‘ä»¬è‡ªå·±å›å‘³äº†ã€‚"
        },
        B: {
          narration: "ä»–è½¬è¿‡å¤´çœ‹ç€ä½ ï¼Œçœ¼ç¥æ‹‰ä¸ã€‚",
          text: "çœŸæ˜¯å†·æ·¡å•Š...ä¸è¿‡æˆ‘å°±å–œæ¬¢ä½ è¿™å‰¯æ‹’äººäºåƒé‡Œä¹‹å¤–çš„æ ·å­ï¼Œç‰¹åˆ«æ˜¯ä¹‹å...å˜å¾—çƒ­æƒ…çš„åå·®ã€‚"
        }
    }
};

// çŠ¶æ€ç®¡ç†
let isPlaying = false;
let currentScript = null;
let typeWriterTimer = null;

// å¤„ç†åå­—æ›¿æ¢
function replaceUserName(text) {
    if (!text || typeof text !== 'string') return text;
    
    // æ›¿æ¢"ç®¬äº‘"ä¸ºè‡ªå®šä¹‰åå­—
    return text.replace(/ç®¬äº‘/g, USER_NAME_DISPLAY);
}

// åˆå§‹åŒ–å¼¹å¹•åˆ—è¡¨
function initDanmaku() {
    const list = document.getElementById('danmakuList');
    
    // å…ˆæ¸…ç©ºåˆ—è¡¨
    list.innerHTML = '';
    
    // ä½¿ç”¨å¤„ç†åçš„è¯„è®ºæ•°æ®
    const processedComments = comments.map(comment => {
        const processedComment = { ...comment };
        
        // æ›¿æ¢è¯„è®ºæ–‡æœ¬ä¸­çš„"ç®¬äº‘"
        processedComment.text = replaceUserName(comment.text);
        
        // å¤„ç†è„šæœ¬ä¸­çš„æ–‡æœ¬
        if (comment.script) {
            const processedScript = JSON.parse(JSON.stringify(comment.script));
            
            // æ›¿æ¢av_startä¸­çš„æ–‡æœ¬
            processedScript.av_start.narration = replaceUserName(processedScript.av_start.narration);
            processedScript.av_start.text = replaceUserName(processedScript.av_start.text);
            
            // æ›¿æ¢choicesä¸­çš„æ–‡æœ¬
            processedScript.choices.forEach(choice => {
                choice.text = replaceUserName(choice.text);
            });
            
            // æ›¿æ¢av_responseä¸­çš„æ–‡æœ¬
            Object.keys(processedScript.av_response).forEach(key => {
                processedScript.av_response[key].narration = replaceUserName(processedScript.av_response[key].narration);
                processedScript.av_response[key].text = replaceUserName(processedScript.av_response[key].text);
            });
            
            processedComment.script = processedScript;
        }
        
        return processedComment;
    });
    
    // ç”Ÿæˆå¼¹å¹•åˆ—è¡¨
    processedComments.forEach(c => {
        const item = document.createElement('div');
        item.className = 'danmaku-item';
        item.onclick = () => playScenario(c.id);
        item.innerHTML = `
          <div class="avatar">${c.avatar}</div>
          <div>
          <span class="username">@${c.user}</span>
          <span class="comment-content">${c.text}</span>
          </div>
        `;
        list.appendChild(item);
    });
}

// æ’­æ”¾åœºæ™¯ä¸»é€»è¾‘
function playScenario(id) {
    if (isPlaying) return;
    isPlaying = true;
    
    // UIçŠ¶æ€æ›´æ–°
    document.getElementById('nowPlayingTopic').style.display = 'block';
    document.getElementById('nowPlayingTopic').innerText = "TOPIC: #" + id + " å›å¤ä¸­...";
    
    // è·å–å‰§æœ¬
    const commentData = comments.find(c => c.id === id);
    currentScript = commentData.script || genericScript;

    // å¤„ç†å½“å‰å‰§æœ¬ä¸­çš„åå­—æ›¿æ¢
    if (currentScript) {
        const processedScript = JSON.parse(JSON.stringify(currentScript));
        
        processedScript.av_start.narration = replaceUserName(processedScript.av_start.narration);
        processedScript.av_start.text = replaceUserName(processedScript.av_start.text);
        
        processedScript.choices.forEach(choice => {
            choice.text = replaceUserName(choice.text);
        });
        
        Object.keys(processedScript.av_response).forEach(key => {
            processedScript.av_response[key].narration = replaceUserName(processedScript.av_response[key].narration);
            processedScript.av_response[key].text = replaceUserName(processedScript.av_response[key].text);
        });
        
        currentScript = processedScript;
    }

    // ç¦ç”¨å¼¹å¹•ç‚¹å‡»
    document.querySelectorAll('.danmaku-item').forEach(el => el.classList.add('disabled'));

    // ç¬¬ä¸€é˜¶æ®µï¼šç ‚é‡‘å›åº”
    playDialogue(CHAR_NAME, currentScript.av_start.narration, currentScript.av_start.text, () => {
        // æ˜¾ç¤ºé€‰é¡¹
        showChoices();
    });
}

// æ’­æ”¾å¯¹è¯ï¼ˆå«æ‰“å­—æœºæ•ˆæœï¼‰
function playDialogue(speaker, narration, text, callback) {
    const narrationEl = document.getElementById('narrationText');
    const speakerEl = document.getElementById('speakerName');
    const captionEl = document.getElementById('captionText');
    const box = document.querySelector('.dialogue-box');

    // è®¾ç½®æ ·å¼
    narrationEl.classList.remove('active');
    setTimeout(() => {
        narrationEl.innerText = narration;
        narrationEl.classList.add('active');
    }, 300);

    speakerEl.innerText = speaker;
    if (speaker === USER_NAME) {
        speakerEl.classList.add('user');
        box.style.borderLeftColor = '#f91880';
    } else {
        speakerEl.classList.remove('user');
        box.style.borderLeftColor = '#d9b665';
    }

    // æ‰“å­—æœºæ•ˆæœ
    captionEl.innerText = "";
    let i = 0;
    clearInterval(typeWriterTimer);
    typeWriterTimer = setInterval(() => {
        captionEl.innerText += text.charAt(i);
        i++;
        if (i >= text.length) {
          clearInterval(typeWriterTimer);
          if (callback) setTimeout(callback, 1000); // è¯»å®Œæš‚åœ1ç§’
        }
    }, 50); // æ‰“å­—é€Ÿåº¦
}

// æ˜¾ç¤ºé€‰é¡¹
function showChoices() {
    const overlay = document.getElementById('choiceOverlay');
    const btnA = document.getElementById('choiceA');
    const btnB = document.getElementById('choiceB');

    btnA.innerText = currentScript.choices[0].text;
    btnB.innerText = currentScript.choices[1].text;

    btnA.onclick = () => handleUserChoice('A');
    btnB.onclick = () => handleUserChoice('B');

    overlay.classList.add('active');
}

// å¤„ç†ç”¨æˆ·é€‰æ‹©
function handleUserChoice(key) {
    const overlay = document.getElementById('choiceOverlay');
    overlay.classList.remove('active');

    // è·å–ç”¨æˆ·å°è¯
    const userTextRaw = currentScript.choices[key === 'A' ? 0 : 1].text;
    
    // ç®€å•çš„è§£æï¼šå†’å·å‰æ˜¯åŠ¨ä½œï¼Œå†’å·åæ˜¯å°è¯
    let userAction = "ä½ åšå‡ºäº†å›åº”ã€‚";
    let userSpeech = userTextRaw;
    if (userTextRaw.includes("ï¼š")) {
        const parts = userTextRaw.split("ï¼š");
        userAction = "ä½ " + parts[0];
        userSpeech = parts[1];
    }

    // æ’­æ”¾ç”¨æˆ·å›åº”
    playDialogue(USER_NAME, userAction, userSpeech, () => {
        // æ’­æ”¾ç ‚é‡‘æœ€ç»ˆå›åº”
        const finalResponse = currentScript.av_response[key];
        playDialogue(CHAR_NAME, finalResponse.narration, finalResponse.text, () => {
          // ç»“æŸäº¤äº’
          isPlaying = false;
          document.querySelectorAll('.danmaku-item').forEach(el => el.classList.remove('disabled'));
          document.getElementById('nowPlayingTopic').style.display = 'none';
        });
    });
}

// å¤„ç†å¯åŠ¨
function startApp() {
    const nameInput = document.getElementById('userNameInput');
    const startBtn = document.getElementById('startBtn');
    const startModal = document.getElementById('startModal');
    const mainContent = document.getElementById('mainContent');
    
    // è®¾ç½®é»˜è®¤åç§°
    nameInput.value = USER_NAME_DISPLAY;
    
    // å¼€å§‹æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    startBtn.addEventListener('click', function() {
        const inputName = nameInput.value.trim();
        
        if (!inputName) {
            alert('è¯·è¾“å…¥ä¸€ä¸ªåå­—ï¼');
            nameInput.focus();
            return;
        }
        
        // æ›´æ–°å…¨å±€å˜é‡
        USER_NAME = inputName;
        USER_NAME_DISPLAY = inputName;
        
        // æ›´æ–°é¡µé¢æ ‡é¢˜
        document.title = `X Live - Aventurine & ${USER_NAME_DISPLAY}`;
        
        // éšè—å¼¹çª—ï¼Œæ˜¾ç¤ºä¸»å†…å®¹
        startModal.classList.add('hidden');
        mainContent.style.display = 'flex';
        
        // åˆå§‹åŒ–åº”ç”¨
        initDanmaku();
    });
    
    // å›è½¦é”®è§¦å‘å¼€å§‹
    nameInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            startBtn.click();
        }
    });
}

// å¯åŠ¨åº”ç”¨
window.onload = startApp;

</script>

</body>
</html>